"use strict";(self.webpackChunksiglens_docs=self.webpackChunksiglens_docs||[]).push([[3089],{8570:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var s=n(5893),r=n(1151);const o={},a="Go App",i={id:"instrument-traces/go-app",title:"Go App",description:"Auto-instrument sample Golang app for traces",source:"@site/docs/instrument-traces/go-app.md",sourceDirName:"instrument-traces",slug:"/instrument-traces/go-app",permalink:"/siglens-docs/instrument-traces/go-app",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Instrumentation for Traces",permalink:"/siglens-docs/category/instrumentation-for-traces"},next:{title:"Java App",permalink:"/siglens-docs/instrument-traces/java-app"}},c={},l=[{value:"Auto-instrument sample Golang app for traces",id:"auto-instrument-sample-golang-app-for-traces",level:2},{value:"Quickstart",id:"quickstart",level:2},{value:"More Details",id:"more-details",level:2},{value:"Next Steps",id:"next-steps",level:2}];function h(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"go-app",children:"Go App"}),"\n",(0,s.jsx)(t.h2,{id:"auto-instrument-sample-golang-app-for-traces",children:"Auto-instrument sample Golang app for traces"}),"\n",(0,s.jsx)(t.p,{children:"In this tutorial, we will go through the steps to auto-instrument a Go app to send traces to SigLens."}),"\n",(0,s.jsx)(t.h2,{id:"quickstart",children:"Quickstart"}),"\n",(0,s.jsx)(t.p,{children:"Start SigLens:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"curl -L https://siglens.com/install.sh | sh\n"})}),"\n",(0,s.jsx)(t.p,{children:"Start a Go app in a separate terminal:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"git clone https://github.com/siglens/bookstore-app.git\ncd bookstore-app\nSERVICE_NAME=my-service OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:8081/otlp go run main.go\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Go to the bookstore app at ",(0,s.jsx)(t.a,{href:"http://localhost:8090/books",children:"http://localhost:8090/books"})," and refresh the page a few times (you should see ",(0,s.jsx)(t.code,{children:'{"data":[]}'}),") to send traces to SigLens.\nAfter about 10 seconds, you should see the traces on SigLens on ",(0,s.jsx)(t.a,{href:"http://localhost:5122",children:"http://localhost:5122"})," then going to Tracing -> Search Traces and clicking the Find Traces button."]}),"\n",(0,s.jsx)(t.h2,{id:"more-details",children:"More Details"}),"\n",(0,s.jsxs)(t.p,{children:["Instrumenting your existing Go app to send traces to SigLens requires a few extra steps becasue OpenTelemetry doesn't yet have full auto-instrumentation for Go.\nLet's say you have an app that uses the ",(0,s.jsx)(t.a,{href:"https://gin-gonic.com/",children:"Gin"})," framework.\nHere's how you would use the ",(0,s.jsx)(t.code,{children:"otelgin"})," package to instrument the ",(0,s.jsx)(t.code,{children:"gin"})," calls:"]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["In your ",(0,s.jsx)(t.code,{children:"main.go"}),", update your imports section:"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-golang",children:'import (\n    // Existing imports ...\n\n    "go.opentelemetry.io/contrib/instrumentation/github.com/gin-gonic/gin/otelgin"\n    "go.opentelemetry.io/otel"\n    "go.opentelemetry.io/otel/attribute"\n    "go.opentelemetry.io/otel/exporters/otlp/otlptrace"\n    "go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracehttp"\n    "go.opentelemetry.io/otel/sdk/resource"\n    sdktrace "go.opentelemetry.io/otel/sdk/trace"\n)\n'})}),"\n",(0,s.jsxs)(t.ol,{start:"2",children:["\n",(0,s.jsxs)(t.li,{children:["Setup an ",(0,s.jsx)(t.code,{children:"initTracing()"})," function in your ",(0,s.jsx)(t.code,{children:"main.go"}),":"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-golang",children:'var (\n\tserviceName = os.Getenv("SERVICE_NAME")\n)\n\nfunc initTracing() func(context.Context) error {\n\n\texporter, err := otlptrace.New(\n\t\tcontext.Background(),\n\t\totlptracehttp.NewClient(),\n\t)\n\n\tif err != nil {\n\t\tlog.Fatalf("Failed to create exporter: %v", err)\n\t}\n\n\tresources, err := resource.New(\n\t\tcontext.Background(),\n\t\tresource.WithAttributes(\n\t\t\tattribute.String("service.name", serviceName),\n\t\t\tattribute.String("library.language", "go"),\n\t\t),\n\t)\n\n\tif err != nil {\n\t\tlog.Fatalf("Could not set resources: %v", err)\n\t}\n\n\totel.SetTracerProvider(\n\t\tsdktrace.NewTracerProvider(\n\t\t\tsdktrace.WithSampler(sdktrace.AlwaysSample()),\n\t\t\tsdktrace.WithBatcher(exporter),\n\t\t\tsdktrace.WithResource(resources),\n\t\t),\n\t)\n\treturn exporter.Shutdown\n}\n'})}),"\n",(0,s.jsxs)(t.ol,{start:"3",children:["\n",(0,s.jsxs)(t.li,{children:["Call your new ",(0,s.jsx)(t.code,{children:"initTracing()"})," in ",(0,s.jsx)(t.code,{children:"main()"}),":"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-golang",children:"func main() {\n    cleanup := initTracing()\n    defer cleanup(context.Background())\n\n    r := gin.Default()\n    r.Use(otelgin.Middleware(serviceName))\n\n    // Existing code ...\n}\n"})}),"\n",(0,s.jsxs)(t.ol,{start:"4",children:["\n",(0,s.jsxs)(t.li,{children:["Run ",(0,s.jsx)(t.code,{children:"go mod tidy"})," to download all the imported packages"]}),"\n",(0,s.jsx)(t.li,{children:"Run the app:"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"SERVICE_NAME=my-service OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:8081/otlp go run main.go\n"})}),"\n",(0,s.jsxs)(t.ol,{start:"6",children:["\n",(0,s.jsx)(t.li,{children:"Run SigLens in a different terminal"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"curl -L https://siglens.com/install.sh | sh\n"})}),"\n",(0,s.jsxs)(t.ol,{start:"7",children:["\n",(0,s.jsxs)(t.li,{children:["Go to the bookstore app at ",(0,s.jsx)(t.a,{href:"http://localhost:8090/books",children:"http://localhost:8090/books"})," and refresh the page a few times (you should see ",(0,s.jsx)(t.code,{children:'{"data":[]}'}),") to send traces to SigLens."]}),"\n",(0,s.jsxs)(t.li,{children:["After about 10 seconds, you should see the traces on SigLens on ",(0,s.jsx)(t.a,{href:"http://localhost:5122",children:"http://localhost:5122"})," then going to Tracing -> Search Traces and clicking the Find Traces button."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Once you're on the Tracing tab of SigLens, you can search the traces and see health metrics and graphs for each service."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"search-go",src:n(7319).Z+"",width:"2880",height:"1626"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"metrics-go",src:n(2586).Z+"",width:"2847",height:"1629"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"metrics-go-graph-1",src:n(8611).Z+"",width:"2876",height:"1627"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"metrics-go-graph-2",src:n(8166).Z+"",width:"2880",height:"1632"})}),"\n",(0,s.jsx)(t.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(t.p,{children:["Since OpenTelemetry doesn't yet support full auto-instrumentation for Go like it does for some other languages, how you instrument your app will depend on which packages you're currently using.\nCheckout the ",(0,s.jsx)(t.a,{href:"https://opentelemetry.io/ecosystem/registry/",children:"OpenTelemetry Registry"})," to find packages for instrumenting your existing packages."]})]})}function d(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8611:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/go-graph-1-70708ff0d91afe5c6e2ddd026d4788e9.png"},8166:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/go-graph-2-5c5416730f562f573991f662a4bb6335.png"},2586:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/metrics-go-99eccfff24d72f1be4ca4f8e2a24ce72.png"},7319:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/search-traces-go-41fedf97d609ba01045e80ac698e70f7.png"},1151:(e,t,n)=>{n.d(t,{Z:()=>i,a:()=>a});var s=n(7294);const r={},o=s.createContext(r);function a(e){const t=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);