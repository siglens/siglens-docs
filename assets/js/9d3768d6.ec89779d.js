"use strict";(self.webpackChunksiglens_docs=self.webpackChunksiglens_docs||[]).push([[9394],{6703:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var i=s(5893),t=s(1151);const r={},o="Transaction",a={id:"spl-docs/transaction-command",title:"Transaction",description:"Description",source:"@site/docs/spl-docs/transaction-command.md",sourceDirName:"spl-docs",slug:"/spl-docs/transaction-command",permalink:"/siglens-docs/spl-docs/transaction-command",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"top",permalink:"/siglens-docs/spl-docs/top-command"},next:{title:"where command",permalink:"/siglens-docs/spl-docs/where-command"}},d={},l=[{value:"Description",id:"description",level:2},{value:"Syntax",id:"syntax",level:2},{value:"Required Arguments",id:"required-arguments",level:2},{value:"Optional Arguments",id:"optional-arguments",level:2},{value:"field-list",id:"field-list",level:3},{value:"transaction-definition-options",id:"transaction-definition-options",level:3},{value:"startswith",id:"startswith",level:3},{value:"endswith",id:"endswith",level:3},{value:"Filter String Options",id:"filter-string-options",level:2},{value:"&lt;filter-string&gt;",id:"filter-string",level:4},{value:"&lt;search-expression&gt;",id:"search-expression",level:4},{value:"&lt;quoted-search-expression&gt;",id:"quoted-search-expression",level:4},{value:"&lt;eval-expression&gt;",id:"eval-expression",level:4},{value:"Example",id:"example",level:2},{value:"Specifying Multiple Fields",id:"specifying-multiple-fields",level:3},{value:"Basic Examples",id:"basic-examples",level:3},{value:"Group Events by a Single Field",id:"group-events-by-a-single-field",level:4},{value:"Group Events by Multiple Fields",id:"group-events-by-multiple-fields",level:4},{value:"Define Transactions with <code>startswith</code> and <code>endswith</code>",id:"define-transactions-with-startswith-and-endswith",level:4},{value:"Filter Transactions by Duration",id:"filter-transactions-by-duration",level:4},{value:"Define Transactions with <code>eval</code> Expressions",id:"define-transactions-with-eval-expressions",level:4},{value:"Group Events and Filter by Event Count",id:"group-events-and-filter-by-event-count",level:4},{value:"Combining Multiple Conditions",id:"combining-multiple-conditions",level:4},{value:"Use-Case Example",id:"use-case-example",level:3}];function c(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"transaction",children:"Transaction"}),"\n",(0,i.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,i.jsx)(n.p,{children:"The transaction command finds transactions based on events that meet various constraints. Transactions are made up of the raw text (the raw event) of each member, the time and date fields of the earliest member, as well as the union of all other fields of each member."}),"\n",(0,i.jsxs)(n.p,{children:["Additionally, the ",(0,i.jsx)(n.code,{children:"transaction"})," command adds two fields to the raw events, ",(0,i.jsx)(n.code,{children:"duration"})," and ",(0,i.jsx)(n.code,{children:"eventcount"}),". The values in the ",(0,i.jsx)(n.code,{children:"duration"})," field show the difference between the timestamps for the ",(0,i.jsx)(n.code,{children:"first"})," and ",(0,i.jsx)(n.code,{children:"last"})," events in the transaction. The values in the ",(0,i.jsx)(n.code,{children:"eventcount"})," field show the number of events in the transaction."]}),"\n",(0,i.jsxs)(n.p,{children:["In the output, the ",(0,i.jsx)(n.code,{children:"events"})," in a transaction are grouped together as multiple values in the ",(0,i.jsx)(n.code,{children:"Events"})," field. Each event in a transaction starts on a new line by default."]}),"\n",(0,i.jsx)(n.h2,{id:"syntax",children:"Syntax"}),"\n",(0,i.jsxs)(n.p,{children:["The required syntax is in ",(0,i.jsx)(n.strong,{children:"bold"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"transaction"})," ",(0,i.jsx)(n.br,{}),"\n","[<field-list>] ",(0,i.jsx)(n.br,{}),"\n","[<transaction-definition-options>...]"]}),"\n",(0,i.jsx)(n.h2,{id:"required-arguments",children:"Required Arguments"}),"\n",(0,i.jsx)(n.p,{children:"None."}),"\n",(0,i.jsx)(n.h2,{id:"optional-arguments",children:"Optional Arguments"}),"\n",(0,i.jsx)(n.h3,{id:"field-list",children:"field-list"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Syntax"}),": ",(0,i.jsx)(n.code,{children:"<field>..."}),"\n",(0,i.jsx)(n.strong,{children:"Description"}),": One or more field names. The events are grouped into transactions, based on the unique values in the fields. For example, suppose two fields are specified: ",(0,i.jsx)(n.code,{children:"client_ip"})," and ",(0,i.jsx)(n.code,{children:"host"}),". For each ",(0,i.jsx)(n.code,{children:"client_ip"})," value, a separate transaction is returned for each unique ",(0,i.jsx)(n.code,{children:"host"})," value for that ",(0,i.jsx)(n.code,{children:"client_ip"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"transaction-definition-options",children:"transaction-definition-options"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Syntax"}),": ",(0,i.jsx)(n.code,{children:"<startswith>"})," or ",(0,i.jsx)(n.code,{children:"<endswith>"})," ",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Description"}),": Specify the transaction definition options to define your transactions. You can use multiple options to define your transaction."]}),"\n",(0,i.jsx)(n.h3,{id:"startswith",children:"startswith"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Syntax"}),": ",(0,i.jsx)(n.code,{children:"startswith=<filter-string>"})," ",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Description"}),": A search or eval filtering expression which if satisfied by an event marks the beginning of a new transaction."]}),"\n",(0,i.jsx)(n.h3,{id:"endswith",children:"endswith"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Syntax"}),": ",(0,i.jsx)(n.code,{children:"endswith=<filter-string>"})," ",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Description"}),": A search or eval expression which, if satisfied by an event, marks the end of a transaction."]}),"\n",(0,i.jsx)(n.h2,{id:"filter-string-options",children:"Filter String Options"}),"\n",(0,i.jsxs)(n.p,{children:["These options are used with the ",(0,i.jsx)(n.code,{children:"startswith"})," and ",(0,i.jsx)(n.code,{children:"endswith"})," arguments."]}),"\n",(0,i.jsx)(n.h4,{id:"filter-string",children:"<filter-string>"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Syntax"}),": ",(0,i.jsx)(n.code,{children:"<search-expression>"}),", ",(0,i.jsx)(n.code,{children:"(<quoted-search-expression>)"}),", or ",(0,i.jsx)(n.code,{children:"eval(<eval-expression>)"})," ",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Description"}),": A search or eval filtering expression which if satisfied by an event marks the end of a transaction."]}),"\n",(0,i.jsx)(n.h4,{id:"search-expression",children:"<search-expression>"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description"}),": A valid search expression that does not contain quotes."]}),"\n",(0,i.jsx)(n.h4,{id:"quoted-search-expression",children:"<quoted-search-expression>"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description"}),": A valid search expression that contains quotes."]}),"\n",(0,i.jsx)(n.h4,{id:"eval-expression",children:"<eval-expression>"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description"}),": A valid eval expression that evaluates to a Boolean."]}),"\n",(0,i.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,i.jsx)(n.h3,{id:"specifying-multiple-fields",children:"Specifying Multiple Fields"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"transaction"})," command does not necessarily interpret the multiple fields as a conjunction (",(0,i.jsx)(n.code,{children:"field1 AND field2 AND field3"}),") or a disjunction (",(0,i.jsx)(n.code,{children:"field1 OR field2 OR field3"}),") of those fields. If there is a transitive relationship between the fields in the fields list and if the related events appear in the correct sequence, each with a different timestamp, ",(0,i.jsx)(n.code,{children:"transaction"})," command will try to use it. For example, if you searched for"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"... | transaction host cookie\n"})}),"\n",(0,i.jsx)(n.p,{children:"You might see the following events grouped into a transaction:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"event=1 host=a\nevent=2 host=a cookie=b\nevent=3 cookie=b\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"NOTE"}),": If the ",(0,i.jsx)(n.code,{children:"transaction"})," command does not specify any fields to group by, it will default to using the ",(0,i.jsx)(n.code,{children:"timestamp"})," field to group events."]}),"\n",(0,i.jsx)(n.h3,{id:"basic-examples",children:"Basic Examples"}),"\n",(0,i.jsx)(n.h4,{id:"group-events-by-a-single-field",children:"Group Events by a Single Field"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example:"})," Group events by the ",(0,i.jsx)(n.code,{children:"session_id"})," field."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"... | transaction session_id\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This example groups all events with the same ",(0,i.jsx)(n.code,{children:"session_id"})," into a single transaction."]}),"\n",(0,i.jsx)(n.h4,{id:"group-events-by-multiple-fields",children:"Group Events by Multiple Fields"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example:"})," Group events by the combination of ",(0,i.jsx)(n.code,{children:"client_ip"})," and ",(0,i.jsx)(n.code,{children:"host"})," fields."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"... | transaction client_ip host\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This example groups all events with the same combination of ",(0,i.jsx)(n.code,{children:"client_ip"})," and ",(0,i.jsx)(n.code,{children:"host"})," into a single transaction."]}),"\n",(0,i.jsxs)(n.h4,{id:"define-transactions-with-startswith-and-endswith",children:["Define Transactions with ",(0,i.jsx)(n.code,{children:"startswith"})," and ",(0,i.jsx)(n.code,{children:"endswith"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example:"}),' Define a transaction where the first event contains the string "login" and the last event contains the string "logout".']}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'... | transaction session_id startswith="login" endswith="logout"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["This example groups events into transactions that start with a ",(0,i.jsx)(n.code,{children:"login"})," event and end with a ",(0,i.jsx)(n.code,{children:"logout"})," event for each ",(0,i.jsx)(n.code,{children:"session_id"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"filter-transactions-by-duration",children:"Filter Transactions by Duration"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example:"})," Define a transaction and filter transactions that took longer than 60 seconds."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'... | transaction session_id startswith="login" endswith="logout" | where duration > 60\n'})}),"\n",(0,i.jsx)(n.p,{children:'This example filters out transactions where the duration between the "login" and "logout" events is less than 60 seconds.'}),"\n",(0,i.jsxs)(n.h4,{id:"define-transactions-with-eval-expressions",children:["Define Transactions with ",(0,i.jsx)(n.code,{children:"eval"})," Expressions"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example:"})," Define a transaction where the first event has a ",(0,i.jsx)(n.code,{children:"status"}),' field equal to "started" and the last event has a ',(0,i.jsx)(n.code,{children:"status"}),' field equal to "completed".']}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"... | transaction session_id startswith=\"eval(status='started')\" endswith=\"eval(status='completed')\"\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This example groups events into transactions that start with a ",(0,i.jsx)(n.code,{children:"status"}),' of "started" and end with a ',(0,i.jsx)(n.code,{children:"status"}),' of "completed" for each ',(0,i.jsx)(n.code,{children:"session_id"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"group-events-and-filter-by-event-count",children:"Group Events and Filter by Event Count"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example:"})," Define a transaction and filter transactions that have more than 3 events."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"... | transaction session_id | where eventcount > 3\n"})}),"\n",(0,i.jsx)(n.p,{children:"This example filters out transactions that have 3 or fewer events."}),"\n",(0,i.jsx)(n.h4,{id:"combining-multiple-conditions",children:"Combining Multiple Conditions"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example:"})," Define a transaction with multiple fields and filter based on start and end conditions."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'... | transaction client_ip host startswith="GET /start" endswith="POST /end"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["This example groups events into transactions based on ",(0,i.jsx)(n.code,{children:"client_ip"})," and ",(0,i.jsx)(n.code,{children:"host"}),' and starts with a "GET /start" request and ends with a "POST /end" request.']}),"\n",(0,i.jsx)(n.h3,{id:"use-case-example",children:"Use-Case Example"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Identify transactions with the same session ID and IP address"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem:"}),' A user wants to group web access events into transactions based on the same session ID and IP address. Each transaction should start with an event containing the string "view" and end with an event containing the string "purchase." Additionally, the user wants to filter out transactions that took less than a second to complete and display the duration and event count for each transaction.']}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," The ",(0,i.jsx)(n.code,{children:"transaction"})," command can be used to define a transaction based on the session ID (",(0,i.jsx)(n.code,{children:"JSESSIONID"}),") and IP address (",(0,i.jsx)(n.code,{children:"clientip"}),"). The ",(0,i.jsx)(n.code,{children:"startswith"})," and ",(0,i.jsx)(n.code,{children:"endswith"})," arguments specify the start and end events of the transaction. The ",(0,i.jsx)(n.code,{children:"where"})," command can then be used to filter transactions based on their duration."]}),"\n",(0,i.jsx)(n.p,{children:"Assume the ingested data format is like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"_time, clientip, JSESSIONID, event\n2023-07-01T12:00:00Z, 192.168.1.1, ABC123, view\n2023-07-01T12:05:00Z, 192.168.1.1, ABC123, add_to_cart\n2023-07-01T12:10:00Z, 192.168.1.1, ABC123, purchase\n2023-07-01T12:15:00Z, 192.168.1.1, XYZ789, view\n2023-07-01T12:20:00Z, 192.168.1.1, XYZ789, browse\n2023-07-01T12:25:00Z, 192.168.1.1, XYZ789, purchase\n"})}),"\n",(0,i.jsx)(n.p,{children:"For the above data, the query will be:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'sourcetype=access_* \n| transaction JSESSIONID clientip startswith="view" endswith="purchase" \n| where duration > 1\n| table JSESSIONID clientip duration eventcount\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Explanation:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"transaction"})," command groups events by ",(0,i.jsx)(n.code,{children:"JSESSIONID"})," and ",(0,i.jsx)(n.code,{children:"clientip"}),". It defines the first event in the transaction using the ",(0,i.jsx)(n.code,{children:'startswith="view"'})," argument and the last event using the ",(0,i.jsx)(n.code,{children:'endswith="purchase"'})," argument."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"where"})," command filters out transactions that took less than a second to complete by using the ",(0,i.jsx)(n.code,{children:"duration"})," field, which is added by the ",(0,i.jsx)(n.code,{children:"transaction"})," command."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"table"})," command is used to display the relevant fields (",(0,i.jsx)(n.code,{children:"JSESSIONID"}),", ",(0,i.jsx)(n.code,{children:"clientip"}),", ",(0,i.jsx)(n.code,{children:"duration"}),", ",(0,i.jsx)(n.code,{children:"eventcount"}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Output:"})}),"\n",(0,i.jsx)(n.p,{children:"The output for the above command based on the mentioned data would look like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"JSESSIONID   clientip    duration   eventcount\nABC123       192.168.1.1 600        3\nXYZ789       192.168.1.1 600        3\n"})}),"\n",(0,i.jsx)(n.p,{children:"This approach groups events into meaningful transactions, filters out any transactions that did not take a significant amount of time, and displays the duration and event count for each transaction, providing a clear view of user interactions."})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>a,a:()=>o});var i=s(7294);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);