"use strict";(self.webpackChunksiglens_docs=self.webpackChunksiglens_docs||[]).push([[9107],{8569:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var c=o(5893),t=o(1151);const r={},i="Vector",s={id:"migration/gcloud/vector",title:"Vector",description:"Migrating from Google Cloud to SigLens using Vector",source:"@site/docs/migration/gcloud/vector.md",sourceDirName:"migration/gcloud",slug:"/migration/gcloud/vector",permalink:"/siglens-docs/migration/gcloud/vector",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Migrating from Google Cloud",permalink:"/siglens-docs/category/migrating-from-google-cloud"},next:{title:"Migrating from AWS CloudWatch",permalink:"/siglens-docs/category/migrating-from-aws-cloudwatch"}},a={},l=[{value:"1. Install Vector and setup Google Cloud CLI",id:"1-install-vector-and-setup-google-cloud-cli",level:2},{value:"Setup Google Cloud Pub/Sub",id:"setup-google-cloud-pubsub",level:3},{value:"1. Set or Create a Google Cloud Project",id:"1-set-or-create-a-google-cloud-project",level:4},{value:"2. Create a Pub/Sub Topic",id:"2-create-a-pubsub-topic",level:4},{value:"3. Create a Logging Sink",id:"3-create-a-logging-sink",level:4},{value:"4. Grant Permissions to the Logging Service Account",id:"4-grant-permissions-to-the-logging-service-account",level:4},{value:"5. Create a Service Account",id:"5-create-a-service-account",level:4},{value:"6. Grant Pub/Sub Editor Role to the New Service Account",id:"6-grant-pubsub-editor-role-to-the-new-service-account",level:4},{value:"7. Generate Key for the New Service Account(Skip if you have an existing one)",id:"7-generate-key-for-the-new-service-accountskip-if-you-have-an-existing-one",level:4},{value:"8. Grant Pub/Sub Subscriber Role to an Existing Service Account from a Different Project",id:"8-grant-pubsub-subscriber-role-to-an-existing-service-account-from-a-different-project",level:4},{value:"9. Create a Pub/Sub Subscription",id:"9-create-a-pubsub-subscription",level:4},{value:"10. Test the Subscription (Optional)",id:"10-test-the-subscription-optional",level:4},{value:"2. Configure Vector",id:"2-configure-vector",level:2},{value:"3. Run Vector",id:"3-run-vector",level:2}];function u(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h1,{id:"vector",children:"Vector"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.em,{children:"Migrating from Google Cloud to SigLens using Vector"})}),"\n",(0,c.jsx)(n.h2,{id:"1-install-vector-and-setup-google-cloud-cli",children:"1. Install Vector and setup Google Cloud CLI"}),"\n",(0,c.jsx)(n.p,{children:"Prerequisites:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Google Cloud CLI (Verify your Google Cloud CLI installation with ",(0,c.jsx)(n.code,{children:"gcloud version"})," or you can install it from ",(0,c.jsx)(n.a,{href:"https://cloud.google.com/sdk/docs/install-sdk",children:"here"}),")"]}),"\n",(0,c.jsxs)(n.li,{children:["Vector (You can follow ",(0,c.jsx)(n.a,{href:"/siglens-docs/log-ingestion/vector#1-installation",children:"this guide"})," to get started with installing vector)"]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"setup-google-cloud-pubsub",children:"Setup Google Cloud Pub/Sub"}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h4,{id:"1-set-or-create-a-google-cloud-project",children:"1. Set or Create a Google Cloud Project"}),"\n",(0,c.jsx)(n.p,{children:"If you already have a Google Cloud project, set it as your current project:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud config set project <project_id>\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Replace ",(0,c.jsx)(n.code,{children:"<project_id>"})," with your actual project ID."]}),"\n",(0,c.jsx)(n.p,{children:"If you don't have a project, create one:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud projects create <project_id>\n"})}),"\n",(0,c.jsx)(n.h4,{id:"2-create-a-pubsub-topic",children:"2. Create a Pub/Sub Topic"}),"\n",(0,c.jsx)(n.p,{children:"Create a Pub/Sub topic where logs will be published:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud pubsub topics create <topic_name>\n"})}),"\n",(0,c.jsx)(n.h4,{id:"3-create-a-logging-sink",children:"3. Create a Logging Sink"}),"\n",(0,c.jsx)(n.p,{children:"When you create a sink, Google Cloud automatically creates a new service account. This service account, known as the logging service account, is used by the sink to write logs."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud logging sinks create <sink_name> pubsub.googleapis.com/projects/<project_id>/topics/<topic_name>\n"})}),"\n",(0,c.jsx)(n.h4,{id:"4-grant-permissions-to-the-logging-service-account",children:"4. Grant Permissions to the Logging Service Account"}),"\n",(0,c.jsxs)(n.p,{children:["Grant the ",(0,c.jsx)(n.code,{children:"pubsub.publisher"})," role to the logging service account:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud projects add-iam-policy-binding <project_id> --member=serviceAccount:<logging_service_account> --role=roles/pubsub.publisher\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Replace ",(0,c.jsx)(n.code,{children:"<logging_service_account>"})," with the service account name displayed after creating the sink."]}),"\n",(0,c.jsx)(n.h4,{id:"5-create-a-service-account",children:"5. Create a Service Account"}),"\n",(0,c.jsxs)(n.blockquote,{children:["\n",(0,c.jsxs)(n.p,{children:["\u26a0\ufe0f"," ",(0,c.jsx)(n.strong,{children:"Note:"})," Skip this step if you have an existing service account"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["If you have a service account and a key from a different project, and you want to use it in your current project, you can skip to ",(0,c.jsx)(n.a,{href:"./vector#8-grant-pubsub-subscriber-role-to-an-existing-service-account-from-a-different-project",children:"Step 8"})]}),"\n",(0,c.jsx)(n.p,{children:"If you don't have a service account, create one:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'gcloud iam service-accounts create <service_account_name> --display-name "My Service Account"\n'})}),"\n",(0,c.jsx)(n.h4,{id:"6-grant-pubsub-editor-role-to-the-new-service-account",children:"6. Grant Pub/Sub Editor Role to the New Service Account"}),"\n",(0,c.jsxs)(n.blockquote,{children:["\n",(0,c.jsxs)(n.p,{children:["\u26a0\ufe0f"," ",(0,c.jsx)(n.strong,{children:"Note:"})," Skip this step if you have an existing service account"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["Grant the ",(0,c.jsx)(n.code,{children:"pubsub.editor"})," role to the service account:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud projects add-iam-policy-binding <project_id> --member serviceAccount:<service_account_name>@<project_id>.iam.gserviceaccount.com --role roles/pubsub.editor\n"})}),"\n",(0,c.jsx)(n.h4,{id:"7-generate-key-for-the-new-service-accountskip-if-you-have-an-existing-one",children:"7. Generate Key for the New Service Account(Skip if you have an existing one)"}),"\n",(0,c.jsxs)(n.blockquote,{children:["\n",(0,c.jsxs)(n.p,{children:["\u26a0\ufe0f"," ",(0,c.jsx)(n.strong,{children:"Note:"})," Skip this step if you have an existing service account key"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"If you don't have a service account key, create one:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud iam service-accounts keys create ~/key.json --iam-account <service_account_name>@<project_id>.iam.gserviceaccount.com\n"})}),"\n",(0,c.jsx)(n.h4,{id:"8-grant-pubsub-subscriber-role-to-an-existing-service-account-from-a-different-project",children:"8. Grant Pub/Sub Subscriber Role to an Existing Service Account from a Different Project"}),"\n",(0,c.jsxs)(n.blockquote,{children:["\n",(0,c.jsxs)(n.p,{children:["\u26a0\ufe0f"," ",(0,c.jsx)(n.strong,{children:"Note:"})," Skip this step if you're not using a service account from a different project"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"If you have a service account and a key from a different project, you need to add the necessary permissions to the service account in your current project like this:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud projects add-iam-policy-binding <project_id> --member=serviceAccount:<service_account_name>@<existing_project_id>.iam.gserviceaccount.com --role=roles/pubsub.subscriber\n"})}),"\n",(0,c.jsx)(n.h4,{id:"9-create-a-pubsub-subscription",children:"9. Create a Pub/Sub Subscription"}),"\n",(0,c.jsx)(n.p,{children:"Create a Pub/Sub subscription to the topic:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud pubsub subscriptions create <subscription_name> --topic <topic_name>\n"})}),"\n",(0,c.jsx)(n.h4,{id:"10-test-the-subscription-optional",children:"10. Test the Subscription (Optional)"}),"\n",(0,c.jsx)(n.p,{children:"Pull messages from the subscription to test it:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud pubsub subscriptions pull --auto-ack <subscription_name>\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Remember to replace ",(0,c.jsx)(n.code,{children:"<project_id>"}),", ",(0,c.jsx)(n.code,{children:"<logging_service_account>"}),", ",(0,c.jsx)(n.code,{children:"<service_account_name>"})," and ",(0,c.jsx)(n.code,{children:"<existing_project_id>"})," with your actual project ID and service account names."]}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"2-configure-vector",children:"2. Configure Vector"}),"\n",(0,c.jsxs)(n.p,{children:["Below is an example of a Vector configuration file that you can use. You'll need to replace the ",(0,c.jsx)(n.code,{children:"<project_id>"})," and ",(0,c.jsx)(n.code,{children:"<subscription_name>"})," fields with your own values."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:"data_dir: /var/lib/vector\nsources:\n  gcp_pubsub_logs:\n    type: gcp_pubsub\n    project: <project_id>\n    subscription: <subscription_name>\n    credentials_path: key.json # Path to the service account key json\n# Transforms Reference: Transform the data from Sources into desired format\n# Ensure to adjust this section to match the format of your data.\ntransforms:\n  remap_file_log:\n    inputs:\n      - 'gcp_pubsub_logs'\n    type: 'remap'\n    source: |\n# The parsed json is stored in the structured variable. The structured variable is merged with the other data/fields.\n      structured = parse_json!(.message)\n      ., err = merge(., structured)\n      if err != null {\n        log(\"Failed to merge structured data into event: \" + to_string(err), level: \"error\")\n      }\nsinks:\n  splunk_hec:\n    type: splunk_hec_logs\n    inputs:\n      - gcp_pubsub_logs\n    endpoint: http://localhost:8081\n    host_key: hostname\n    index: 'siglens-gcloud' # Replace with desired index\n    indexed_fields:\n      - index\n    timestamp_key: time\n    compression: none\n    encoding:\n      codec: json\n    default_token: 'A94A8FE5CCB19BA61C4C08'\n    batch:\n      max_events: 1\n"})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["The ",(0,c.jsx)(n.code,{children:"<credentials_path>"})," should point to your service account key, which would be ",(0,c.jsx)(n.code,{children:"key.json"})," which would be key.json if you followed the Google Cloud Pub/Sub setup steps above."]}),"\n",(0,c.jsxs)(n.li,{children:["Remember to adjust the ",(0,c.jsx)(n.code,{children:"transforms"})," section in the configuration to match the format of your data. For detailed information on how to configure transforms for your specific logs, refer to the ",(0,c.jsx)(n.a,{href:"https://vector.dev/docs/reference/configuration/transforms/",children:"Transforms section"})," in the official Vector documentation."]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"3-run-vector",children:"3. Run Vector"}),"\n",(0,c.jsxs)(n.p,{children:["Vector needs to be started with the ",(0,c.jsx)(n.code,{children:"--config"})," argument to specify the path to the configuration file. Run the following command:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"vector --config vector.yaml\n"})})]})}function d(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(u,{...e})}):u(e)}},1151:(e,n,o)=>{o.d(n,{Z:()=>s,a:()=>i});var c=o(7294);const t={},r=c.createContext(t);function i(e){const n=c.useContext(r);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),c.createElement(r.Provider,{value:n},e.children)}}}]);