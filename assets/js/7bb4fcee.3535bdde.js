"use strict";(self.webpackChunksiglens_docs=self.webpackChunksiglens_docs||[]).push([[1131],{2999:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>g,frontMatter:()=>o,metadata:()=>u,toc:()=>d});var l=t(5893),r=t(1151),a=t(4866),s=t(5162);const o={},i="Fluentd",u={id:"migration/awscloudwatch/fluentd",title:"Fluentd",description:"Migrating/Stream Logs from AWS CloudWatch to SigLens through Fluentd.",source:"@site/docs/migration/awscloudwatch/fluentd.md",sourceDirName:"migration/awscloudwatch",slug:"/migration/awscloudwatch/fluentd",permalink:"/siglens-docs/migration/awscloudwatch/fluentd",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"AWS Lambda",permalink:"/siglens-docs/migration/awscloudwatch/aws-lambda"},next:{title:"Migrating from Datadog",permalink:"/siglens-docs/category/migrating-from-datadog"}},c={},d=[{value:"1. Fluentd Installation",id:"1-fluentd-installation",level:2},{value:"2. IAM Role Configuration",id:"2-iam-role-configuration",level:3},{value:"3. Environment Setup (skip if using EC2 IAM role)",id:"3-environment-setup-skip-if-using-ec2-iam-role",level:3},{value:"Export AWS credentials and region:",id:"export-aws-credentials-and-region",level:4},{value:"4. CloudWatch Logs Plugin Installation",id:"4-cloudwatch-logs-plugin-installation",level:3},{value:"For Fluentd",id:"for-fluentd",level:4},{value:"For td-agent",id:"for-td-agent",level:4},{value:"5. Fluentd Configuration",id:"5-fluentd-configuration",level:3},{value:"3. Run Fluentd",id:"3-run-fluentd",level:3}];function h(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h1,{id:"fluentd",children:"Fluentd"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.em,{children:"Migrating/Stream Logs from AWS CloudWatch to SigLens through Fluentd."})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Prerequisites"}),": AWS account with logs in CloudWatch Logs Group."]}),"\n",(0,l.jsx)(n.h2,{id:"1-fluentd-installation",children:"1. Fluentd Installation"}),"\n",(0,l.jsxs)(n.p,{children:["Install ",(0,l.jsx)(n.a,{href:"https://docs.fluentd.org/installation",children:"Fluentd"})," on your server."]}),"\n",(0,l.jsx)(n.h3,{id:"2-iam-role-configuration",children:"2. IAM Role Configuration"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Create an IAM role with the following permissions to allow Fluentd to access CloudWatch Logs:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Action": [\n                "logs:GetLogEvents",\n                "logs:DescribeLogStreams"\n            ],\n            "Effect": "Allow",\n            "Resource": "*"\n        }\n    ]\n}\n'})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"For authentication purposes, Fluentd requires the IAM Role's Access Key ID and Secret Access Key:"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"For EC2 instances"}),": If Fluentd is running on an EC2 instance, instead of manually managing Access Keys, it's recommended to use an IAM role attached to the EC2 instance. This approach simplifies credential management and enhances security."]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Navigate to the EC2 dashboard within the AWS Management Console."}),"\n",(0,l.jsx)(n.li,{children:"Select the instance you want to attach the IAM role to."}),"\n",(0,l.jsxs)(n.li,{children:["In the ",(0,l.jsx)(n.code,{children:"Actions"})," menu, choose ",(0,l.jsx)(n.code,{children:"Security"}),", then ",(0,l.jsx)(n.code,{children:"Modify IAM role"}),"."]}),"\n",(0,l.jsx)(n.li,{children:"Choose the IAM role that has the necessary permissions outlined above from the dropdown list."}),"\n",(0,l.jsxs)(n.li,{children:["Click ",(0,l.jsx)(n.code,{children:"Save"})," to attach the role to the instance."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"By attaching an IAM role, EC2 instances will automatically have access to AWS services based on the role's permissions without the need for Access Keys."}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"For non-EC2 setups"}),": If Fluentd is not running on an EC2 instance, you will need to manually manage and provide Access Keys for authentication."]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Navigate to the IAM console."}),"\n",(0,l.jsx)(n.li,{children:"Find the IAM role you created with the necessary permissions."}),"\n",(0,l.jsxs)(n.li,{children:["Under the ",(0,l.jsx)(n.code,{children:"Security credentials"})," tab, create a new Access Key."]}),"\n",(0,l.jsx)(n.li,{children:"Securely store the Access Key ID and Secret Access Key presented to you."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"3-environment-setup-skip-if-using-ec2-iam-role",children:"3. Environment Setup (skip if using EC2 IAM role)"}),"\n",(0,l.jsx)(n.h4,{id:"export-aws-credentials-and-region",children:"Export AWS credentials and region:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'export AWS_REGION=us-east-1\nexport AWS_ACCESS_KEY_ID="YOUR_ACCESS_KEY"\nexport AWS_SECRET_ACCESS_KEY="YOUR_SECRET_ACCESS_KEY"\n'})}),"\n",(0,l.jsxs)(n.h3,{id:"4-cloudwatch-logs-plugin-installation",children:["4. ",(0,l.jsx)(n.a,{href:"https://github.com/fluent-plugins-nursery/fluent-plugin-cloudwatch-logs",children:"CloudWatch Logs Plugin Installation"})]}),"\n",(0,l.jsx)(n.h4,{id:"for-fluentd",children:"For Fluentd"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"gem install fluent-plugin-cloudwatch-logs\n"})}),"\n",(0,l.jsx)(n.h4,{id:"for-td-agent",children:"For td-agent"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"td-agent-gem install fluent-plugin-cloudwatch-logs\n"})}),"\n",(0,l.jsx)(n.h3,{id:"5-fluentd-configuration",children:"5. Fluentd Configuration"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Read more about the ",(0,l.jsx)(n.a,{href:"https://github.com/fluent-plugins-nursery/fluent-plugin-cloudwatch-logs?tab=readme-ov-file#in_cloudwatch_logs",children:"Fluentd CloudWatch source configuration from here"})]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-xml",metastring:'title="fluentd.conf"',children:'<source>\n  @type cloudwatch_logs\n  tag cloudwatch.your_tag\n  region us-east-1\n  log_group_name "/aws/lambda/siglensSaasOrgsStats"\n  #use_log_group_name_prefix true\n  log_stream_name "2024"\n  use_log_stream_name_prefix true  # To Stream all the Logs from the log streams that start with name 2024.\n  state_file /var/lib/fluent/group_stream.in.state1\n  <parse>\n    @type none\n    #@type json   # if your cloudwatch logs are in json.\n  </parse>\n</source>\n\n<match cloudwatch.*>\n  @type http\n  endpoint http://127.0.0.1:8081/services/collector/event\n  open_timeout 2\n  <format>\n    @type json\n  </format>\n  <buffer>\n    flush_interval 5s\n  </buffer>\n</match>\n'})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["For log record transformation or filtering, leverage Fluentd\u2019s filter plugin. Detailed guidance can be found in the ",(0,l.jsx)(n.a,{href:"https://docs.fluentd.org/configuration",children:"Fluentd documentation"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"3-run-fluentd",children:"3. Run Fluentd"}),"\n",(0,l.jsx)(a.Z,{className:"bg-light",defaultValue:"unix",values:[{label:"Linux",value:"unix"}],children:(0,l.jsxs)(s.Z,{value:"unix",children:[(0,l.jsxs)(n.p,{children:["Navigate to the Fluentd directory and run the following command. If using td-agent, replace ",(0,l.jsx)(n.code,{children:"fluentd"})," with ",(0,l.jsx)(n.code,{children:"td-agent"}),"."]}),(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo fluentd -c /home/fluentd.conf\n"})})]})}),"\n",(0,l.jsx)(n.p,{children:"Make sure to set the correct path to Fluentd and its config file."})]})}function g(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},5162:(e,n,t)=>{t.d(n,{Z:()=>s});t(7294);var l=t(6010);const r={tabItem:"tabItem_Ymn6"};var a=t(5893);function s(e){let{children:n,hidden:t,className:s}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,l.Z)(r.tabItem,s),hidden:t,children:n})}},4866:(e,n,t)=>{t.d(n,{Z:()=>y});var l=t(7294),r=t(6010),a=t(2466),s=t(6550),o=t(469),i=t(1980),u=t(7392),c=t(12);function d(e){return l.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,l.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,l.useMemo)((()=>{const e=n??function(e){return d(e).map((e=>{let{props:{value:n,label:t,attributes:l,default:r}}=e;return{value:n,label:t,attributes:l,default:r}}))}(t);return function(e){const n=(0,u.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function g(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function f(e){let{queryString:n=!1,groupId:t}=e;const r=(0,s.k6)(),a=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,i._X)(a),(0,l.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(r.location.search);n.set(a,e),r.replace({...r.location,search:n.toString()})}),[a,r])]}function p(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,a=h(e),[s,i]=(0,l.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!g({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const l=t.find((e=>e.default))??t[0];if(!l)throw new Error("Unexpected error: 0 tabValues");return l.value}({defaultValue:n,tabValues:a}))),[u,d]=f({queryString:t,groupId:r}),[p,m]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[r,a]=(0,c.Nk)(t);return[r,(0,l.useCallback)((e=>{t&&a.set(e)}),[t,a])]}({groupId:r}),x=(()=>{const e=u??p;return g({value:e,tabValues:a})?e:null})();(0,o.Z)((()=>{x&&i(x)}),[x]);return{selectedValue:s,selectValue:(0,l.useCallback)((e=>{if(!g({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);i(e),d(e),m(e)}),[d,m,a]),tabValues:a}}var m=t(2389);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=t(5893);function v(e){let{className:n,block:t,selectedValue:l,selectValue:s,tabValues:o}=e;const i=[],{blockElementScrollPositionUntilNextRender:u}=(0,a.o5)(),c=e=>{const n=e.currentTarget,t=i.indexOf(n),r=o[t].value;r!==l&&(u(n),s(r))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=i.indexOf(e.currentTarget)+1;n=i[t]??i[0];break}case"ArrowLeft":{const t=i.indexOf(e.currentTarget)-1;n=i[t]??i[i.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":t},n),children:o.map((e=>{let{value:n,label:t,attributes:a}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:l===n?0:-1,"aria-selected":l===n,ref:e=>i.push(e),onKeyDown:d,onClick:c,...a,className:(0,r.Z)("tabs__item",x.tabItem,a?.className,{"tabs__item--active":l===n}),children:t??n},n)}))})}function b(e){let{lazy:n,children:t,selectedValue:r}=e;const a=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=a.find((e=>e.props.value===r));return e?(0,l.cloneElement)(e,{className:"margin-top--md"}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,l.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function w(e){const n=p(e);return(0,j.jsxs)("div",{className:(0,r.Z)("tabs-container",x.tabList),children:[(0,j.jsx)(v,{...e,...n}),(0,j.jsx)(b,{...e,...n})]})}function y(e){const n=(0,m.Z)();return(0,j.jsx)(w,{...e,children:d(e.children)},String(n))}},1151:(e,n,t)=>{t.d(n,{Z:()=>o,a:()=>s});var l=t(7294);const r={},a=l.createContext(r);function s(e){const n=l.useContext(a);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),l.createElement(a.Provider,{value:n},e.children)}}}]);